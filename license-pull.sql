SELECT DISTINCT top 100 People.PeopleCode,WebValidFolder.WebDisplayFlag,Folder.FolderRSN, Folder.StampDate,  People.PeopleRSN, People.NameFirst, People.NameLast, People.NameMiddle,  Folder.ReferenceFile, Folder.StatusCode, Folder.FinalDate, ValidStatus.StatusDesc,  Folder.FolderType, Folder.SubCode,  dbo.f_info_alpha(Folder.FolderRSN,10490) Specialty,  (select top 1 t.AddrCity from (select 1 seq, p.AddrCity from People p, PeoplePeople pp, ValidCounty vc where pp.AddressPeopleRSN = p.PeopleRSN and p.AddrCountyCode=vc.CountyCode and pp.AddressCode = 10   and pp.PeopleRSN = FolderPeople.PeopleRSN union select 2 seq, p.AddrCity from People p, PeoplePeople pp, ValidCounty vc   where pp.AddressPeopleRSN = p.PeopleRSN and p.AddrCountyCode=vc.CountyCode and pp.AddressCode = 20   and pp.PeopleRSN = FolderPeople.PeopleRSN union select 3 seq, p.AddrCity from People p, PeoplePeople pp, ValidCounty vc   where pp.AddressPeopleRSN = p.PeopleRSN and p.AddrCountyCode=vc.CountyCode and pp.AddressCode = 15 and pp.PeopleRSN = FolderPeople.PeopleRSN) t) AddrCity,  (select top 1 t.CountyDesc from    (select 1 seq, vc.CountyDesc from People p, PeoplePeople pp, ValidCounty vc where pp.AddressPeopleRSN = p.PeopleRSN    and p.AddrCountyCode=vc.CountyCode and pp.AddressCode = 10 and pp.PeopleRSN = FolderPeople.PeopleRSN union    select 2 seq, vc.CountyDesc from People p, PeoplePeople pp, ValidCounty vc where pp.AddressPeopleRSN = p.PeopleRSN     and p.AddrCountyCode=vc.CountyCode and pp.AddressCode = 20 and pp.PeopleRSN = FolderPeople.PeopleRSN union  select 3 seq, vc.CountyDesc from People p, PeoplePeople pp, ValidCounty vc   where pp.AddressPeopleRSN = p.PeopleRSN and p.AddrCountyCode=vc.CountyCode   and pp.AddressCode = 15 and pp.PeopleRSN = FolderPeople.PeopleRSN) t) CountyDesc  FROM Folder,WebValidFolder,People,FolderPeople,ValidStatus  WHERE Folder.FolderRSN = FolderPeople.FolderRSN   AND FolderPeople.PeopleRSN = People.PeopleRSN  AND Folder.StatusCode = ValidStatus.StatusCode  AND FolderPeople.PeopleCode = 1  AND Folder.StatusCode not in (30, 40)  AND ((Folder.FolderType = 'LIC' AND Folder.SubCode != 10005 ) OR   (Folder.FolderType = 'TEMP' AND Folder.SubCode = 30000 ) OR    (Folder.FolderType = 'ANES' AND (Folder.SubCode = 20000 or Folder.SubCode = 20005)))  AND Folder.ReferenceFile IS NOT NULL  AND Folder.StampDate IS NOT NULL  AND Folder.FolderType = WebValidFolder.FolderType  AND SUBSTRING(WebValidFolder.WebDisplayFlag,1,1) = 'Y'   AND upper(People.NameFirst) like :NameFirst  AND upper(People.NameMiddle) like :NameMiddle  AND upper(People.NameLast) like :NameLast  AND upper(Folder.ReferenceFile) like :ReferenceFile  AND Folder.StatusCode like :StatusCode  AND ISNULL(People.LicenceNumber, '') like :PublicDisciplinary  AND FolderPeople.PeopleRSN in (SELECT pp.PeopleRSN FROM PeoplePeople pp, People p2  WHERE pp.AddressPeopleRSN = p2.PeopleRSN AND pp.AddressCode in (10,20)  AND isnull(p2.AddrCountyCode, '') like ISNULL(:AddrCountyCode, isnull(p2.AddrCountyCode,''))  AND isnull(upper(p2.AddrCity),'') like  ISNULL(:AddrCity, isnull(p2.AddrCity,'')))
